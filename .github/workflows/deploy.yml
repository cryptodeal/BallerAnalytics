name: Build & Deploy
on: [push]
jobs:

  deploy:
    name: Deploy to digitalocean droplet
    runs-on: ubuntu-latest
    steps:
    - name: deploy data import cron jobs
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DATA_IMPORT_SSH_HOST }}
        key: ${{ secrets.DATA_IMPORT_SSH_KEY }}
        username: ${{ secrets.DATA_IMPORT_SSH_USERNAME }}
        script: |
            pnpm add -g pm2
            pm2 stop all
            pm2 delete all
            rm -rf BallerAnalytics
            git clone -b TempVercelFix git@github.com:cryptodeal/BallerAnalytics.git
            cp .env ./BallerAnalytics
            cp .env ./BallerAnalytics/web
            cp .env ./BallerAnalytics/packages/nba-api-ts
            cd BallerAnalytics
            pnpm install
            cd packages/nba-api-ts
            pnpm build
            pm2 start "node --experimental-specifier-resolution=node dist/scripts/cron" --name cron